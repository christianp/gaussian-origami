<html>
<head>
  <style>
  body {
    margin: 0;
    padding: 0;
  }
  svg {
    width: 100vw;
  }
  circle {
    transition: r 0.5s, fill 0.5s;
  }
  </style>
  <script src="main.js"></script>
</head>
<body>
  <main>
    <section id="elm"></section>
    <section id="rules">
      <h1>Gaussian origami</h1>
      <p>There are two things you can do:</p>
      <ul>
        <li><strong>Fold</strong> - remove every point on one side of a line, and add their mirror images on the other side.</li>
        <li><strong>Unfold</strong> - keep all the existing points, and add their mirror images when reflected in a line too.</li>
      </ul>
      <p>Click on a line to fold or unfold. When you're folding, the side that gets removed depends on which side of the origin your mouse is.</p>
      <p>What patterns can you make?</p>
    </section>
  </main>
  <script>
    console.clear();
    var observer = new MutationObserver(function (mutations) {
      mutations.forEach(function (mutation) {
        if (mutation.type === 'childList') {
          Array
            .from(mutation.addedNodes)
            .forEach(function (node) {
              node.addEventListener('mousemove', function (event) {
                let t = event.target;
                while(t && t.tagName.toLowerCase()!='svg') {
                  t = t.parentElement;
                }
                if(!t) {
                  return;
                }
                const point = t.createSVGPoint()
                point.x = event.clientX
                point.y = event.clientY
                const position = point.matrixTransform(t.getScreenCTM().inverse())                
                var svgClickEvent = new CustomEvent('svgclick', {
                  detail: {x: position.x, y: position.y}
                });
                t.dispatchEvent(svgClickEvent);
              });
            });
        }
      });
    });
    
    observer.observe(document.body, { childList: true, subtree: true });    
    
    
    var app = Elm.Main.init({ node: document.getElementById('elm') })
    // you can use ports and stuff here
  </script>
</body>
</html>
